<div class="form">
  <form
    (ngSubmit)="addItemList()"
    [formGroup]="form"
    tuiAppearance="floating"
    tuiCardLarge
    tuiForm="m"
  >
    <header tuiHeader>
      <div>
        <h2 tuiTitle>Valor Total</h2>
        <h1 tuiTitle class="valor">R$ {{valorTotal() | number:'1.2-2':'pt-BR'}}</h1>
      </div>
    </header>

    <tui-textfield>
        <label tuiLabel>Valor</label>
        <input
            formControlName="valor"
            placeholder="R$ 0,00"
            tuiTextfield
            mask="separator.2"
            prefix="R$ "
            type="tel"
        />
    </tui-textfield>
    <tui-error
        formControlName="valor"
        [error]="[] | tuiFieldError | async"
    />

    <tui-textfield>
        <label tuiLabel>Quantidade</label>
        <input
            formControlName="quantidade"
            placeholder="0"
            tuiTextfield
            mask="0*"
            type="number"
        />
    </tui-textfield>
    <tui-error
        formControlName="quantidade"
        [error]="[] | tuiFieldError | async"
    />

    <tui-textfield>
        <label tuiLabel>Produto</label>
        <input
            formControlName="produto"
            placeholder="Leite"
            tuiTextfield
        />
    </tui-textfield>
    <tui-error
        formControlName="produto"
        [error]="[] | tuiFieldError | async"
    />
    <div>
      <button type="submit" tuiButton>Adicionar a lista</button>
    </div>
  </form>


  @if(list().length > 0) {
    <tui-scrollbar>
      <cdk-virtual-scroll-viewport
          #viewport
          appendOnly
          tuiScrollable
          class="viewport tui-zero-scrollbar"
          [itemSize]="45"
          [maxBufferPx]="600"
          [minBufferPx]="400"
      >
          <table
              tuiTable
              [columns]="columns"
          >
              <thead>
                  <tr tuiThGroup>
                      <th
                          *tuiHead="'valor'"
                          tuiTh
                          [style.top.px]="-(viewport.getOffsetToRenderedContentStart() || 0)"
                      >
                          Valor
                      </th>
                      <th
                          *tuiHead="'produto'"
                          tuiTh
                          [style.top.px]="-(viewport.getOffsetToRenderedContentStart() || 0)"
                      >
                          Produto
                      </th>
                      <th
                          *tuiHead="'quantidade'"
                          tuiTh
                          [style.top.px]="-(viewport.getOffsetToRenderedContentStart() || 0)"
                      >
                          Quantidade
                      </th>
                      <th
                          *tuiHead="'actions'"
                          tuiTh
                          [style.top.px]="-(viewport.getOffsetToRenderedContentStart() || 0)"
                      >
                          ações
                      </th>
                  </tr>
              </thead>
              <tbody tuiTbody>
                  <tr
                      *cdkVirtualFor="let item of list() | tuiTableSort; let i = index"
                      tuiTr
                  >
                      <td
                          *tuiCell="'valor'"
                          tuiTd
                      >
                          R$ {{ item.valor | number:'1.2-2':'pt-BR' }}
                      </td>
                      <td
                          *tuiCell="'produto'"
                          tuiTd
                      >
                          {{ item.produto }}
                      </td>
                      <td
                          *tuiCell="'quantidade'"
                          tuiTd
                      >
                          {{ item.quantidade }}
                      </td>
                      <td
                          *tuiCell="'actions'"
                          tuiTd
                      >
                          <button
                            tuiButton
                            appearance="accent"
                            (click)="removerItem(i)"
                            iconEnd="@tui.trash"
                            size="s"
                          ></button>
                      </td>
                  </tr>
              </tbody>
          </table>
      </cdk-virtual-scroll-viewport>
    </tui-scrollbar>
  }
</div>
